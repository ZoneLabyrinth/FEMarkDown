# 图片

### 响应式图片

1. 通过js检测窗口大小

2. css媒体查询

3. img标签属性

   ```html
   <img srcset="img-320w.jpg,img-640.jpg 2x, img-960w.jpg3x" src='img-96-w.jpg' alt='img' >
   ```

### 

#### 逐步加载图像

- 使用统一占位符
- 使用LQIP
  - 低质量图像占位符（low quality image placeholders)
  - npm install lqip
- 使用SQIP
  - 基于SVG的图像占位符（SVG Quality image Placeholders）
  - npm install sqip

#### web font

## 服务器优化



## 提升CSS渲染性能

- 谨慎使用expensive属性
- 尽量减少样式层级
- 尽量避免使用占用过多CUP和内存的属性（text-indent:-9999px)
- 及那辆避免使用耗电量大的属性



## JS优化

### 变量函数优化

- ·事件委托
- 避免eval
- 节流防抖

### 动画优化

- 避免添加大量js动画
- 尽量使用css3动画
- 尽量使用Canvas动画
- 合理使用requestAnimationFrame代替setTimeout、setInterval

### 合理使用缓存

- 合理缓存DOM对象
- 缓存列表长度
- 使用可缓存的Ajax

### Cookie

- 应用于
  - 会话管理：登录名，购物车商品，游戏得分或服务器应要记录的其他内容
  - 个性化：用户首选项，主题或其他设置
  - 跟踪：记录和分析用户行为，比如埋点

### sessionStorage

- 创建一个本地存储的键值对
- 应用于：
  - 页面之间传值

### IndexedDB

- 索引数据库
- 应用于：
  - 客户端存储大量结构化数据
  - 没有网络连接的情况下使用（比如google doc，石墨文档）
  - 将冗余、很少修改、但经常访问的数据，以避免随时从服务器获取数据

### LocalStorage

- 本地存储
- 应用于：
  - 缓存静态文件内容js/css（比如百度M站首页）
  - 缓存不常变更单API接口数据
  - 存储地理位置信息
  - 浏览在页面的具体位置

### CSS

- 避免样式嵌套
- 避免使用CSS表达式
- 使用绝对定位，可以让动画元素脱离文档流
- 避免使用table布局
- 尽量不适用float布局
- 图片最好设置好width和height
- 尽量简化浏览器不必要的人物，减少页面重新布局
- 使用viewport设置屏幕缩放级别
- 避免频繁设置样式，最好把心style属性设置完成后，进行一次性更改
- 避免使用引起回流/重绘属性，最好把相应变量缓存起来

### js

- 最小化回流和重排
  - 合并多次DOM修改
- 控制绘制过程和绘制区域
  - 绘制过程开销比较大的属性设置应该尽量减少使用
  - 减少绘制区域范围

#### 控制DOM大小

- 节点过多，查找节点，绑定事件，冒泡捕获都会很耗时
- 控制DOM大小的技巧包括：
  - 合理的业务逻辑
  - 延迟加载即将呈现的内容

#### 简化DOM操作

- 统一操作后，统一插入到DOM Tree中
- 可以使用fragment,尽量不在页面的DOM Tree里直接操作
- 虚拟DOM，通过diff算法简化和减少DOM操作

## 静态文件

### 压缩

Html ,js,css压缩

### 静态文件打包

- 公共组件拆分
- 压缩：JS/CSS/图片
- 合并：JS/CSS文件合并，CSS sprite
- 服务端方式：Combo： JS/CSS文件 Combo http://cdn.com//??a.js,b.js内容

### 静态文件版本号更新策略

- 缓存更新
  - CDN或ng祸胎刷新文件路径，更新文件header头
- 文件name.v1-v100.js
  - 大功能迭代每次新增一个大版本，比如由V1到v2
  - 小功能迭代新增加0.0.1或0.1.0，比如从v1.0.0至v1.0.1
  - 年末ng通知配置所有版本302
- 时间戳.文件 name.js
- 文件hash.name.js
  - 以文件内容hash做key
  - 每次上线，文件路径不一致

### webpack 打包优化

- 体积大模块
- 删除没有使用的依赖
- 生产模式进行公共依赖包抽离
- 开发模式进行DLL&&DLL REFERENCE分包

## 页面渲染

#### 浏览器渲染过程

1. 解析HTML生成DOM Tree 
2. 解析 CSS 生成CSSOM Tree
3. render tree js通过DOM API和 CSSOM API来操作 DOM Tree和 CSS Rule Tree, 浏览器将DOM Tree和 CSSOM Tree合同渲染书
4. 布局（layout）：根据生成的Render Tree，进行回流，计算每个节点的几何信息
5. 绘制（painting）：根据渲染树和回流得到的集合信息，得到每个节点的绝对像素
6. 展示（display）：将像素发送给图形处理器（GPU），展示在页面上

### 页面渲染技术架构和方案总览

1. 服务端渲染
   - 后端同步渲染、同构直出
2. 客户端渲染
   -   js渲染：静态化、前后单分离、SPA
   - Web App：

### 后端同步渲染



同构直出

- 定义
  - 一套代码既可以在服务端运行又可以在客户端运行，这就是同构
- 技术优势
  - 性能：降低首屏渲染时间
  - SEO
  - 兼容性
  - 代码同构：利于灾备

Next.js nuxt.js



### PWA

- 技术优势
  - 可以用手机屏幕启动应用，即使在离线状态或弱网下，通过实现缓存的资源，也可以正常加载运行当前应用，可以完全消除对网络的依赖，从而给用户非常可靠的体验
  - 因为预先缓存了资源，部分资源无需经过网络，及秒开页面。
  - 和移动设备上的原生应用一样，具有沉浸式的用户体验
  - 内容可以被搜索引擎收录
  - 可以给用户发送离线推送消息。

- 技术实现
  - 全站改造成HTTPS,没有HTTPS就没有Service Worker。
  - 应用Service Worker技术提升性能，离线提供静态资源文件，提升首屏用户体验。
  - 使用App Manifest
  - 考虑离线小题推送
- 浏览器兼容性
  - ServiceWorkerGlobalScope API 88%
  - Web App Manifest 83%

### 懒加载

图片 src设为空  data-lazy=“https://"

### 预加载

- 定义：

  - 可以使用预加载让浏览器来预先加载某些资源（图片、js、css），而这些资源是在将来才会被使用到。简单来说就是讲所需资源提前加载到浏览器本地，这样后面在需要使用的时候就可以直接从浏览器缓存中去了，而不用在重新开始加载

- 好处

  - 减少用户后续加载资源等待的时间。

- 实现方式：

- 使用preload,prefetch和preconnect

  ```js
  <link rel="preload" href='src/style.css' as='style'>
  <link rel="prefetch" href="src/image.png">
  <link rel="dns-prefetch” href="https://ali.com">
  <link rel="preconnect" href="https://my.com" crossorigin>
  ```

### 预渲染

- 好处：

  - 对于大型项目，在懒加载组件被加载之前，组件可能还会有其他拦击加载组件的代码或数据，所以用户还是需要时间等待组件加载完成。
  - 那另外一种预加载组件的方式就是提前渲染它。在页面中渲染组件，但是并不在页面中展示，也就是渲染好后先隐藏起来，用的时候在直接展示。

- 实现方式：

  ```js
  <link rel="prerender" href="https://my.com"
  ```

### 按需加载

- 常规
- 不同App ： SDK
- 不同设备： 样式
- 不同分辨率： 媒体查询

### 楼层式加载

- 定义：

  - 楼层数据异步加载和本地缓存相结合的方式

- 实现方式：

  ```js
  <div class="lazy=fn" data-title="服装" id="lazy-clothes" data-path="floor1-floor_index.js" data-time="01dfas12342kjljk432"></div>
  ```

## 接口服务调用优化

1. 接口合并
   - 指一个页面的众多业务接口和依赖的第三方接口统一使一个部署在集群的接口统一调用，以减少页面接口请求数
2. 接口上CDN
   - 基于接口性能考虑，可以吧不需要实时更新的接口同步至CDN，等此接口内容编程之后自动同步至CDN集群上。如果一定时间内未请求到数据，会源站接口在此骑牛。
3. 接口域名上CDN 
   - 增强可用性、稳定性
4. 接口降级
   - 基于大促备战考虑，核心接口进行降级用基础接口进行业务实现，比如千人千面的推荐接口，在大促时间点可以直接运营编辑的数据。另外接口外衣无法访问，使用预设好的垫底备份数据。
5. 接口监控
   - 监控接口成功率，不是常说的TP99，而是和用户实际情况一致的成功和失败监控，包括比如弱网、超市、网络异常、网络切换等情况、排除出问题需要联合后端、运维、网络岗位人员一并解决



### 接口缓存粗略优化

1. Ajax/fetch 缓存
   - 前端请求时带上cache，依赖浏览器本身缓存机制
2. 本地缓存
   - 异步接口数据优先使用本地localstorage中的缓存数据。
3. 多次请求
   - 接口数据本地无localstorage 缓存数据，重新在此发出ajax请求



